# Как разработать тему Pagekit

<p class="uk-article-lead">Это учебное пособие научит вас как создавать собственную тему на основе нашей заготовки темы Hello Theme. Вы узнаете о структуре темы и следуя необходимым шагам добавите новые опции и позиции в теме.</p>

<span class="uk-badge">Внимание</span> Завершённая тема [находится на Github](https://github.com/pagekit/example-theme).

## Начало работы

Перед началом обучения, мы предполагаем что у вас уже установлена Pagekit на локальном сервере, а если это не так, то вам нужно, [скачать](https://pagekit.com/download) пакет инсталятора Pagekit и [установить](getting-started/installation) её. После чего зайдите в панель администратора в раздел *System / Theme*, который интегрирован с Marketplace.

[Hello Theme](https://pagekit.com/marketplace/package/pagekit/theme-hello) - является шаблоном-заготовкой для разработки будущих тем, которая включает примеры кода и общую основу чтобы помочь вам начать работу.

Тема Hello не предоставляет никакого стилевого оформления, но при этом является хорошей отправной точкой для разработки собственной темы.

В первую очередь после установки темы нужно ознакомится с файловой структурой. После установки, тема Hello будет находится в папке *packages/pagekit/theme-hello/*. Если вы  bбудете разрабатывать свои собственные темы в будущем, мы рекомендуем установить простую тему, чтобы использовать её для справки, например [Theme One](https://pagekit.com/marketplace/package/pagekit/theme-one).

## Структура

Давайте взглянем на некоторые основные файлы и папки с которыми вы будете иметь дело при разработке собственной темы.

```txt
theme-name/
├─ css/
│  └─ theme.css
├─ js/
│  └─ theme.js
├─ views
│  └─ template.php
├─ composer.json
├─ image.jpg
├─ index.php
├─ CHANGELOG.md
└─ README.md
```

* *css/theme.css* - основной CSS файл с предопределёнными классами
* *js/theme.js* - пустой JS файл для ваших скриптов
* *views/template.php* - рендерит вывод темы; позиции лого, меню, основного контейнера, сайдбара и футера доступны по умолчанию
* *composer.json* - определение темы
* *image.jpg* - скриншот темы
* *index.php* - основной конфиг темы
* *CHANGELOG.md* - логи изменений
* *README.md* - описание темы

### Переименование вашей темы

Если вы просто измените файлы темы Hello, то любые обновления в Marketplace для этой темы перезапишет ваши собственные изменения. Кроме этого, вы вероятно захотите указать для темы собственное название. Если вы решите загрузить собственную тему на Marketplace, то вам также понадобится назвать вашу тему как то иначе. Для этого потребуется три простых шага:

1. Скопировать все файлы с *packages/pagekit/theme-hello* в *packages/your-name/your-theme* (вам нужно будет создать данную папку)
2. Открыть файл *composer.json* и заменить `"name": "pagekit/theme-hello"` на `"name": "your-name/your-theme"`. А также изменить `"title": "Hello"` на `"title": "Your theme"`.
3. Открыть *index.php* и заменить `'name' => 'theme-hello'` на `'name' => 'your-theme'`.

Для простоты, дальше в примерах всё ещё будет использоваться `theme-hello`.

### CSS

Тема Hello не содержит каких либо стилей. Она включает файл *css/theme.css* со списком всех CSS классов, которые рендерят расширения ядра Pagekit без дополнительной стилизации. Вы можете добавить свой собственный CSS к этим классам.

Админка Pagekit и дефолтная тема Pagekit созданны с использованием [фронт-энд фреймворка UIkit](http://getuikit.com/), поэтому вы можете использовать и его для своих проектов. В дальнейших примерах, мы будем создавать нашу собственную тема с использованием UIkit. Если вы будете использовать другой фреймворк или не будете использовать какой-либо фреймворк вообще, основные принципы подключения CSS будут похожи.

Есть множество всевозможных способов настроить файловою структуру вашей темы. Мы можем рекомендовать два подхода. Первый - это простое подключение CSS файлов. Второй - более сложный, но предоставляет гораздо больше гибкости.

#### Простой способ: Подключение CSS файлов

Перейдите на [веб-сайт UIkit](http://getuikit.com/), скачайте и распакуйте последнюю версию фреймворка. UIkit идёт с тремя темами: Default, Gradient и Almost Flat. Для подключения дефолной темы (Default), скопируйте файл *css/uikit.min.css* из архива UIkit и переместите в папку *theme-hello/css/* вашей темы.

Чтобы убедиться что файл Pagekit загружается, откройте основной файл макета темы *theme-hello/views/template.php*

Внутри `<head>` файла макета, мы видим что один CSS файл уже подключён.

```php
<?php $view->style('theme', 'theme:css/theme.css') ?>
```

Теперь добавьте еще одну строку, чтобы подключить CSS файл UIKit. Вам нужно подключить его (*css/uikit.min.css*) выше основного файла CSS.

```php
<?php $view->style('custom-uikit', 'theme:css/uikit.min.css') ?>
<?php $view->style('theme', 'theme:css/theme.css') ?>
```

Теперь ваша тема содержит CSS UIkit. Для добавления ваших собственных CSS правил, вам нужно отредактировать файл *theme-hello/css/theme.css*.

#### Продвинутый способ: Использование Gulp и LESS

В предыдущем разделе мы увидели, как легко можно добавить простые CSS файлы к вашей теме. Если у вас есть опыт создания веб-сайтов, то вы возможно знакомы с более гибкими способами стилизации вашего контента, например применение CSS препроцессора, такого как [LESS] (http://lesscss.org/). Это позволяет использовать такие вещи, как переменные, которые делают ваш код более удобным для чтения и управления.

При использовании UIKit, это даёт вам большое преимущество, потому что вы можете просто изменить переменную, чтобы применить глобальные изменения, например, изменяя основной цвет темы.

Чтобы работать комфортно с предпроцессором LESS, вам необходимо установить несколько инструментов, которыми можно работать через командную строку: `npm`, `gulp` и `bower`. Если они у вас ещё не установленны, тогда вам следует это сделать используя Google, чтобы найти необходимые учебные пособия.

Имеется множество возможных вариантов огранизовать файловую структуру. Мы предлагаем структуру, которая также используется для официальных тем Pagekit. В первый раз это создаёт впечатление, что вы выполняете много шагов при создании темы, но на практике это позволяет хорошо структурировать ваш код, легко кастомизировать и поддерживать UIKit в актуальном состоянии.

#### Шаг №1

В вашей теме, создайте новые файлы *package.json*, *bower.json*, *.bowerrc*, *gulpfile.js* и *less/theme.less*. Вставьте следующий конент в ваши файлы. Если ваша тема названа по другому, замените любый вхождения (occurences) строки `theme-hello` на название вашей темы.

*package.json*. Этот файл определяет все JavaScript зависимости, которые будут устанавливаться во время запуска команды `npm install` и подключает несколько npm пакетов, которые мы будем использовать, например при компиляции LESS в CSS:

*package.json*

```json
{
	"name": "theme-hello",
	"devDependencies": {
		"bower": "*",
		"gulp": "*",
		"gulp-less": "*",
		"gulp-rename": "*"
	 }
}
```

*bower.json* говорит Bower получать новые версии UIkit. В таком случае, вы всегда можете использовать `bower install` для получения текущих LESS файлов от UIkit:

*bower.json*

```json
{
	"name": "theme-hello",
	"dependencies": {
		"uikit": "*"
	},
	"private": true
}
```

*.bowerrc* подключает настройки конфигурации для Bower. По умолчанию, Bower устанавливает всё в директорию */bower_components* внутри директории темы. Давайте изменим эту дефолтную директорию:

*.bowerrc*

```json
{
    "directory": "app/assets"
}
```

*gulpfile.js* содержит все задачи, которые мы можем запускать используя Gulp. Нам нужна только задача для компиляции LESS в CSS. Для удобства мы также добавим задачу `watch`, которая будет автоматически запускать перекомпиляцию LESS при любых изменениях в файлах с расширением _*.less_ внутри директории *less/*:

*gulpfile.js*

```js
var gulp = require('gulp'),
	less = require('gulp-less'),
	rename = require('gulp-rename');

	gulp.task('default', function () {
		return gulp.src('less/theme.less', {base: __dirname})
			.pipe(less({compress: true}))
			.pipe(rename(function (file) {
				// the compiled file should be stored in the css/ folder instead of the less/ folder
				file.dirname = file.dirname.replace('less', 'css');
			}))
			.pipe(gulp.dest(__dirname));
	});

	gulp.task('watch', function () {
		gulp.watch('less/*.less', ['default']);
	});
```

*less/theme.less* это место где будут храниться все стили темы. В первую очередь нам нужно импортировать UIkit, который также скомпилируется при помощи задачи Gulp, которую мы определили выше.

*less/theme.less*

```less
@import "uikit/uikit.less";

// use icon font from system
@icon-font-path: "../../../../app/assets/uikit/fonts";

// your theme styles will follow here...
```

*.gitignore* - это не объязательный файл, который будет нам полезен, когда вы будете хранить историю изменений с помощью Git.


В теме Hello, уже существует версионность файлов. Вы можете добавить новые точки изменений, поэтому это будет выглядеть как продолжение. Возможно вы не захотите коммитить скачанные пакеты с помощью Bower и генерируемые CSS. Только будьте уверенными что включаете сгенерируемые CSS, когда будете загружать данную тему на ваш сервер или на Marketplace Pagekit.

*.gitignore*

```txt
/app/bundle/*
/app/assets/*
/node_modules
/css
.DS_Store
.idea
*.zip
```

#### Шаг №2

После создания файлов конфигурации, перейдите на [UIkit Github репозиторий](https://github.com/uikit/uikit) и скачайте и распакуйте zip архив, после чего найдите папку *theme/default* (или другую тему, если пожелаете). Обратите внимание что вам нужна именно GitHub версия для этого, а не просто CSS версия, которую мы скачивали для простой установки.

#### Шаг №3

Создайте папку */less* внутри вашей темы, скопируйте и вставьте сюда папку темы *default/* и переименуйте её в *uikit/*, чтобы она находилась в *less/uikit/* внутри папки с вашей темой.

#### Шаг №4

В файле стилей мы просто импортировали ядро LESS UIKit, так что теперь оно может быть успешно скомпилировано. Для этого вам необходимо обновить путь импорта в файле вашей темы `less/uikit/uikit.less`. Убедитесь в том, что на 4 строке вы изменили путь к импортируемого файла: `@import "../../app/assets/uikit/less/uikit.less";`.

#### Шаг №5

Откройте вашу тему в новой вкладке консоли/терминала (например `cd pagekit/packages/theme-hello`) и запустите `npm install`, `bower install` и `gulp`.

Сейчас мы уже проделали несколько шагов. Вам нужно убедиться в том, что файловая структура у вас имеет следующий вид (плюс дополнительные файлы темы):

* *app/*
	* *assets/* - загруженные библиотеки - результат команды `bower install`
		* *jquery/*
		* *uikit/*
* *css/*
	* *theme.css* - скомпилированный файл CSS - результат команды `gulp`
* *less/*
	* *uikit/*
		* ... uikit компоненты
		* *uikit.less*
	* *theme.less*
* *node_modules/* - модули Node.js - результат команды `npm install`
* *.bowerrc*
* *bower.json*
* *gulpfile.js*
* *package.json*
* ... другие файлы темы

С помощью вышеуказанных команд и данной файловой структуры мы достигнули следующего:

- **Разделения** файлов стилей темы и кастомизации UIKit. Добавляейте свои собственные стили в *less/theme.less* и выполняйте кастомизацию UIKit в *less/uikit/*
- **Упрощённой настройки UIKit** - настройки каждого UIKit компонента находятся в своем собственном _*.less_ файле. Например, чтобы изменить размер шрифта для `body`, откройте *less/uikit/base.less* и измените значение`@base-body-font-size`, а затем повторно запустить `gulp`. Для использования каких-либо из [дополнительных UIKit компонентов](http://getuikit.com/docs/components.html), откройте *less/uikit.less* и импортируйте дополнительный LESS файл из директории *app/assets*, например, для слайд-шоу (slideshow), добавьте строку: `@import "../../app/assets/uikit/less/components/slideshow.less";` и повторно запустите `gulp.`
- **Вы можете легко обновлять UIKit**: Выполните команду `bower install`, чтобы получить последнюю версию UIKit и запустите команду `gulp` для перекомпиляции ваших LESS файлов.

## Добавление JavaScript

В теме Hello, вы найдёте пустой JavaScript файл *js/script.js*. Сюда вы можете добавлять ваш собственный JavaScript код. В теме Hello этот файл загружается потому что он уже подключён в *template.php*:

```php
<?php $view->script('theme', 'theme:js/theme.js') ?>
```

Когда вы подключаете скрипт, требуется уникальный идентификатор (`theme`) и путь к файлу скрипта (`theme:js/theme.js`). Как видете, вы можете использовать `theme:` в качестве короткой версии файлового пути к директории темы. Чтобы добавить больше JavaScript файлов, просто добавьте несколько строк таким же образом. Убедитесь в том, что вы назначили другие идентификаторы для скриптов. Если бы вы назвали их все `theme`, то будет подключён только последний.

```php
<?php $view->script('theme', 'theme:js/theme.js') ?>
<?php $view->script('plugins', 'theme:js/plugins.js') ?>
<?php $view->script('slideshow', 'theme:js/slideshow.js') ?>
```

В то время как добавление нескольких вызовов `script()` - это самый простой способ, чтобы подключить JavaScript, при этом хелпер `script()` предоставляет более мощные способы подключения файлов JavaScript, которые также могут зависеть друг от друга. Более подробно об этом в следующих разделах.

### Добавление несколько JavaScript файлов с зависимостями

В ранее описанных примерах мы не работали с CSS из UIkit. Если вы хотите использовать UIkit JavaScript компоненты и утилиты, имеет смысл добавить UIkit JavaScript файлы. Обратите внимание, что UIkit требует загрузки jQuery перед использованием UIkit JavaScript компонентов.

Locate the previous line `script('theme', ...)` in the head of `views/template.php` and replace it with the following three lines.

```php
<?php $view->script('theme-jquery', 'theme:app/assets/jquery/dist/jquery.min.js') ?>
<?php $view->script('theme-uikit', 'theme:app/assets/uikit/js/uikit.min.js', 'theme-jquery') ?>
<?php $view->script('theme', 'theme:js/theme.js', 'theme-uikit') ?>
```

Этот пример предполагает чтобы вы используете настройки выше, где Bower установил UIkit и jQuery в папку *app/assets/*. Если вместо этого вы использовали простую установку, просто скачайте и скопируйте *jquery.min.js* и *uikit.min.js* в определённое место в вашей темы и измените к ним пути.

Обратите внимание, как теперь мы добавляем третий параметр, который определяет зависимости скрипта, который мы загружаем. Зависимости - это другие JavaScript файлы, которые должны быть загружены ранее. Таким образом, в данном примере, Pagekit будет загружать данные три файла в следующем порядке: jQuery, UIKit, а затем наш *theme.js*. В данном конкретном примере, этот механизм не кажется очень полезным, потому что скрипты, вероятно, будут загружены точно в том порядке, в котором мы поместили их в `template.php`, не так ли? Но, представьте себе, данные строки расположены в разных файлах и суб-шаблонах вашей темы. Поэтому, определяя зависимости убедитесь в том, что Pagekit всегда загружает файлы в правильном порядке.

Как вы уже могли видеть в выше приведенном примере, зависимости ссылаются, используя уникальный строковый идентификатор (например, `theme-jquery`). В нашем примере этот идентификатор дается скрипту в тот момент, когда он подключается с помощью метода `script()`. Как видите, этот метод принимает три параметра: `$view->script($identifier, $path_to_script, $dependencies)`.

Для того, чтобы убедиться что это работает, откройте `views/template.php` и добавьте следующие строки (`data-uk-*` является префиксом для JavaScript компонентов в UIKit).

```html
<!-- ADD id="up" to body -->
<body id="up">
	<!-- LEAVE existing content ... -->
	...
	<!-- ADD to-top-scroller -->
	<div class="uk-text-center">
		<a href="#up" data-uk-smooth-scroll=""><i class="uk-icon-caret-up"></i></a>
	</div>
	<!-- LEAVE rendering of footer section  -->
	<?= $view->render('footer') ?>
</body>
```

При обновлении браузера, вы увидите небольшую стрелку, которую можно использовать для плавного перехода к верхней части окна браузера. Если браузер не прокручивается плавно, а вместо этого резко перемещается вверх, пожалуйста проверьте что вы все написали также как и в примерах.

### Добавление сторонних скриптов, например jQuery

Вы возможно спрашиваете себя, зачем нам вызывать подключёнение jQuery с помощью `theme-jquery`, а не просто `jquery`. Обычно, полезно всегда добавлять префикс к вашим идентификаторам, чтобы избежать конфликтов с другими расширениями. В тоже время, в этом определённом примере, идентификаторы `jquery` и `uikit` уже заняты, потому что Pagekit изначально подключает jQuery и UIkit. Это означает что вы можете загружать эти JavaScript файлы без подлючения их вашей теме. Таким образом, все темы и расширения могут совместно использовать одну версию jQuery (и UIkit, если они используют UIkit) не беспокоясь о конфиктах.

```php
<?php $view->script('theme', 'theme:js/theme.js', ['uikit', 'jquery']) ?>
```

Как видите, в этом примере, третим параметром метода `script()` можно передать несколько зависимостей. В выше приведённом примере, мы передавали только одну строку (например `theme-jquery`). Таким образом вы можете передавать одну или несколько зависимостей.

На текущий момент, загруженные версии jQuery и UIkit зависят от текущей версии Pagekit. С новыми релизами Pagekit, версии этих библиотек будут постоянно обновляться.

## Макет

Основными файлами макета вашей темы являются *views/template.php* и *index.php*. Фактически рендеринг происходит в *template.php*.

Когда вы откроете *template.php*, вы увидите весьма базовые настройки для начала работы. Давайте добавим внешний контейнер для основного контента и разделим системный вывод и сайдбар внутри сетки.

Приблизительно на 30 строке в файле *views/template.php* рендерится позиция сайдбара и контента.

*views/template.php*

```php
<!-- Render widget position -->
<?php if ($view->position()->exists('sidebar')) : ?>
    <?= $view->position('sidebar') ?>
<?php endif; ?>

<!-- Render content -->
<?= $view->render('content') ?>
```

Используя UIkit [Block](http://getuikit.com/docs/block.html) и [Utility](http://getuikit.com/docs/utility.html) компоненты, мы будем создавать позицию блока и контейнера c резиновой (fluid) шириной.

Желательно всегда добавлять свой собственный префикс класса, чтобы они не конфликтовали с другим CSS, который вы будете использовать. Например, все классы UIkit имеют префикс `uk-`. Для того, чтобы различать классы или идентификаторы, которые приходят от этой темы, мы будем использовать префикс `tm-`. Следовательно, мы добавим класс и идентификатор `tm-main` для определения раздела.

*views/template.php*

```html
<div id="tm-main" class="tm-main uk-block">
    <div class="uk-container uk-container-center">

        <!-- Render widget position -->
        <?php if ($view->position()->exists('sidebar')) : ?>
            <?= $view->position('sidebar') ?>
        <?php endif; ?>

        <!-- Render content -->
        <?= $view->render('content') ?>

    </div>
</div>
```

Для более семантического макета, мы будем использовать `<main>` и `<aside>` элементы для контейнеров.

*views/template.php*

```html
<div id="tm-main" class="tm-main uk-block">
    <div class="uk-container uk-container-center">
        <div class="uk-grid" data-uk-grid-match data-uk-grid-margin>
            <main class="<?= $view->position()->exists('sidebar') ? 'uk-width-medium-3-4' : 'uk-width-1-1'; ?>">
                <!-- Render content -->
                <?= $view->render('content') ?>
            </main>
            <?php if ($view->position()->exists('sidebar')) : ?>
            <aside class="uk-width-medium-1-4">
                <?= $view->position('sidebar') ?>
            </aside>
            <?php endif; ?>
        </div>
    </div>
</div>
```

### Элементы темы

Для создания более сложных макетов, вы можете добавить свои собственные позиции виджетов, меню и необходимые опции для них. Обычно тема состоит из виджетов, меню и самого содержимого страницы.

**Содержимое** страницы - это не что иное, как системный вывод Pagekit. Это означает, что содержание любой страницы будет рендериться в этой области.

**Виджеты** - это маленькие куски контента, которые вы можете выводить в разных позициях вашего сайта, таким образом, они будут отображаться в указанных местах разметки вашего сайта.

Для навигации по любому сайту, вам в начале нужно настроить **меню**. Для этого Pagekit предоставляет различные позиции меню, что позволяет пользователям публиковать меню в нескольких местах разметки вашей темы.

В тоже время, перед этим вам нужно зарегистрировать все позиции. Это происходит в файле *index.php* через свойства `menus` и `positions`. Они содержат массивы имён позиции и меток, которые будут отображаться в админ-панели. Этот файл также используется для загрузки дополнительных скриптов и не только.

## Navbar

Как правило, в самом начале нам нужно будет вывести главное меню в вашей теме.

#### Шаг №1

Тема Hello поставляется с предопределённой позицией темы `Main`. Новую позицию следует определять с помощью идентификатора (например`main`) и метки, которая будет отображаться пользователю (например `Main`).

```php
'menu' => [

    'main' => 'Main',

]
```